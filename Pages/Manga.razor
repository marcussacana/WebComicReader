@page "/Manga"
@inject NavigationManager NavManager
@inject IJSRuntime Runtime

<div class="flipbook-viewport">
    <div class="container">
        <div class="flipbook" dir="rtl">
            @if (BookLoader.Pages?.Length > 0)
            {
                @for (int i = 0, x = 0; i < BookLoader.Pages.Length; i++)
                {
                    bool IsFirst = i == 0;
                    bool IsLeft = ((i + x) & 1) != 0;
                    if (BookLoader.IsPortrait[i])
                    {
                        <div class="page" style="background-image:url('@BookLoader.Pages[i]')"></div>
                    }
                    else
                    {
                        if (!IsLeft)
                        {
                            x++;
                            <div class="page"></div>
                        }
                        x++;
                        <div class="double" style="background-image:url('@BookLoader.Pages[i]')"></div>
                    }
                }
            }
        </div>
    </div>
</div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!(BookLoader.Pages == null || BookLoader.Pages.Length == 0))
            await Runtime.InvokeVoidAsync("LoadManga");
        await base.OnAfterRenderAsync(firstRender);
    }

    protected override async Task OnInitializedAsync()
    {
        Program.Runtime = Runtime;
        if (BookLoader.Pages == null || BookLoader.Pages.Length == 0)
            await NavManager.NavigateToHome();

        await base.OnInitializedAsync();
    }
}
